#!/bin/bash

set -eu

ROOT="$(cd $(dirname $0)/.. && pwd)"
OUTPUT="$ROOT/Benchmarks/Tests/TestView.swift"
WEIGHT=$1

cat <<EOS >$OUTPUT
// DO NOT EDIT THIS FILE; IT IS AUTOGENERATED.
// $0

import Atoms
import SwiftUI

struct TestAtom: StateAtom, Hashable {
    let key: Int

    func defaultValue(context: Context) -> Int {
        0
    }
}

struct TestRow: View {
    @Binding
    var value: Int

    var body: some View {
        Text(value.description)
            .frame(maxWidth: .infinity)
            .background(.yellow)
            .onTapGesture {
                value += 1
            }
    }
}

struct TestView: View {
EOS

for i in $(seq 1 $WEIGHT); do
    cat <<EOS >>$OUTPUT
    @WatchState(TestAtom(key: $i))
    var value$i

EOS
done

cat <<EOS >>$OUTPUT
    var body: some View {
        ScrollView {
            VStack {
EOS

for i in $(seq 1 $WEIGHT); do
    cat <<EOS >>$OUTPUT
                TestRow(value: \$value$i)
EOS
done

cat <<EOS >>$OUTPUT
            }
        }
    }
}
EOS
